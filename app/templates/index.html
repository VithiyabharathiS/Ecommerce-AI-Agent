<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>AI-Powered E-commerce Assistant</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container">
        <h1>AI-Powered E-commerce Assistant</h1>

        <div class="input-group">
            <label for="question">Enter your question:</label>
            <input type="text" id="question" placeholder="e.g., Show top 5 products by revenue" required>
        </div>

        <div class="input-group checkbox">
            <input type="checkbox" id="visualize">
            <label for="visualize">Show chart visualization</label>
        </div>

        <div class="input-group">
            <button onclick="askQuestion()">Ask</button>
        </div>

        <div class="output" id="sqlOutput" style="display:none;">
            <h2>Generated SQL Query</h2>
            <pre id="sqlText"></pre>
        </div>

        <div class="output" id="resultOutput" style="display:none;">
            <h2>Results</h2>
            <table id="resultTable"></table>
        </div>

        <div class="output" id="chartOutput" style="display:none;">
            <h2>Visualization</h2>
            <img id="chartImage" src="" width="600" alt="Chart">
        </div>
    </div>

    <script>
        async function askQuestion() {
            const question = document.getElementById("question").value.trim();
            const visualize = document.getElementById("visualize").checked;

            if (!question) return;

            const response = await fetch("/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question })
            });

            const data = await response.json();

            // Show SQL
            document.getElementById("sqlOutput").style.display = "block";
            document.getElementById("sqlText").innerText = data.sql;

            // Show results table
            const table = document.getElementById("resultTable");
            table.innerHTML = "";
            document.getElementById("resultOutput").style.display = "block";

            if (data.result.length > 0) {
                const headers = Object.keys(data.result[0]);

                // Header row
                const thead = table.createTHead();
                const headRow = thead.insertRow();
                headers.forEach(h => {
                    const th = document.createElement("th");
                    th.innerText = h;
                    headRow.appendChild(th);
                });

                // Data rows
                const tbody = table.createTBody();
                data.result.forEach(row => {
                    const tr = tbody.insertRow();
                    headers.forEach(h => {
                        const td = tr.insertCell();
                        td.innerText = row[h];
                    });
                });
            } else {
                table.innerHTML = "<tr><td>No results found.</td></tr>";
            }

            // Show chart if present and user requested
            const chartContainer = document.getElementById("chartOutput");
            const chartImage = document.getElementById("chartImage");

            if (visualize && data.chart) {
                chartContainer.style.display = "block";
                chartImage.src = `data:image/png;base64,${data.chart}`;
            } else {
                chartContainer.style.display = "none";
                chartImage.src = "";
            }
        }
    </script>
</body>

</html>
